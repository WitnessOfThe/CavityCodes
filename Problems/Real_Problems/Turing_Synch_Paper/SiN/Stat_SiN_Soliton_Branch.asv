    clc;
    clear all;
    
%% Define Input Parameters in Physical Units

    SiN       =  Set_Up_Methods_For_Turing_Paper;
    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Input Parameters for SiN  

    N_mode              =  2^8;
    SiN.Stat.In         =  Params_SiN_Modes( N_mode);    
    SiN.Stat.In.N_mode  =  N_mode;
    SiN.Stat.In.mu_bl   =  1;
    SiN.Stat.In.kappa   =  125E6*2*pi;
    SiN.Stat.In.delta   =  6.1*SiN.Stat.In.kappa;
 %  SiN.Stat.In.delta   =  2.5*SiN.Stat.In.kappa;
    SiN.Stat.In.P       =  0.0325;       
    
    SiN.CW.In           =  SiN.Stat.In;

%% Stationary Coefficeints

    SiN.Stat.Par.Equation_string  = 'Kerr_Full_Dispersion';        
    SiN.Stat.Met.Stab_Method      = @LLE_Full_Stability;
    SiN.Stat.Met.InitialGuess     = @Chi_3_Stat_In_Guess_Chi_3_LLE_From_CW;    
    SiN.Stat.Met.Newton           = @Newton_Manual_bicgstab;%'fsolve'
         
    SiN.Stat.Par.variable         = 'delta';  %%'Pump Power';
    SiN.Stat.Par.first_step       = 0.005; % step for delta measured in delta/kappa
    SiN.Stat.Par.step_tol         = 0.001;
    SiN.Stat.Par.step_inc         = 0.00;
    SiN.Stat.Par.step_dec         = 0.5;

    SiN.Stat.Par.bot_boundary     = -40; % bottom boundary for delta to search
    SiN.Stat.Par.top_boundary     =  602; % top boundary for delta to search
    SiN.Stat.Par.Sol_Re_Sign      = '-';
    SiN.Stat.Par.Stability        = 'Yes';
    SiN.Stat.Par.Coeff            = 1.3;
    SiN.Stat.Par.Newton_iter          = 30;      
    SiN.Stat.Par.Newton_tol           = 1E-10;  
    SiN.Stat.Par.i_max                = 1000;
    
    SiN.Stat.Par.fsolveoptions       = optimoptions('fsolve','CheckGradients',...
    false,'Display','iter','UseParallel',true,'SpecifyObjectiveGradient',true,...
    'Algorithm','trust-region-dogleg','FunValCheck','on',...
    'MaxIterations',1000,'StepTolerance',1E-20,'OptimalityTolerance',1E-25);
 ans
%%

   SiN.Stat                      = Chi3_Stat_LLE_Stat_From_Cons_Soliton(SiN.Stat);
   SiN.Stat.Stab                 = Stability_Switcher(SiN.Stat(1));
   SiN.Stat                     = SiN.Stat.Met.Norm(SiN.Stat);    
   SiN.Stat.Sol.Psi_k           = [0.456176948027319 - 0.707330220532904i,-0.412465180009698 + 0.192505834732046i,0.397198931989404 - 0.184871705521190i,-0.371594279699619 + 0.173112178966235i,0.339101264162605 - 0.158505889142928i,-0.303265017647497 + 0.142404907255551i,0.267029530150223 - 0.125991629235131i,-0.232451537565736 + 0.110151746534261i,0.200735902307779 - 0.0954539817919860i,-0.172425868965038 + 0.0821965210944163i,0.147620425760727 - 0.0704785716431989i,-0.126155796087953 + 0.0602697398960096i,0.107734505043797 - 0.0514651527938919i,-0.0920077647733810 + 0.0439241828192349i,0.0786234889325483 - 0.0374952305019067i,-0.0672515850813588 + 0.0320302537065162i,0.0575952919554685 - 0.0273924108574392i,-0.0493941671634086 + 0.0234593359633271i,0.0424304575137820 - 0.0201252086620360i,-0.0364999766638441 + 0.0172955157642109i,0.0314502562024894 - 0.0148933225757856i,-0.0271424894832750 + 0.0128514970853219i,0.0234613193861081 - 0.0111136195379218i,-0.0203097906591831 + 0.00963215763334590i,0.0176063967930762 - 0.00836711018448789i,-0.0152826076743255 + 0.00728482983512368i,0.0132807842209092 - 0.00635701117987362i,-0.0115524275360646 + 0.00555983000765213i,0.0100567150519317 - 0.00487321701306108i,-0.00875928019663118 + 0.00428024953235926i,0.00763119696186324 - 0.00376664674948118i,-0.00664813587064994 + 0.00332035662172568i,0.00578966267309544 - 0.00293122579395193i,-0.00503865490481375 + 0.00259074594711425i,0.00438081253619975 - 0.00229186952746755i,-0.00380423299317718 + 0.00202888253494844i,0.00329899370738804 - 0.00179731393126732i,-0.00285655375646350 + 0.00159387781071212i,0.00246742728028674 - 0.00141673199146936i,-0.00219233701917518 + 0.00118549631801190i,0.00186629067933267 - 0.00111979456707371i,-0.00161740594610172 + 0.00100712176312978i,0.00140749082153302 - 0.000910577182739046i,-0.00123038167340471 + 0.000828993362042499i,0.00108162566951570 - 0.000760505079984493i,-0.000957492840549848 + 0.000703389059548334i,0.000854862781830252 - 0.000656274043813134i,-0.000771209619765177 + 0.000618223187909138i,0.000704626792600413 - 0.000588785894823978i,-0.000653920294187078 + 0.000568089548744556i,0.000618841067331491 - 0.000557058904895871i,-0.000600623107443444 + 0.000557930422371017i,0.000603286656327601 - 0.000575491349361994i,-0.000637206499794111 + 0.000620400457683015i,0.000731160967590043 - 0.000720001315079879i,-0.000991138387208228 + 0.000967754192316284i,0.00228993468569082 - 0.00199671946110366i,0.00205361143250971 - 0.00317814156387113i,-0.000563230205773120 + 0.000696152425118168i,0.000272103416775700 - 0.000330027489580845i,-0.000155984914486169 + 0.000190357470150975i,9.68423699658983e-05 - 0.000120111619476200i,-6.28205752186994e-05 + 7.97390796464669e-05i,4.18082212821849e-05 - 5.46689148830087e-05i,-2.82317776466442e-05 + 3.83091048985023e-05i,1.91931800245138e-05 - 2.72646901874208e-05i,-1.30531390717003e-05 + 1.96251507758962e-05i,8.82620346496539e-06 - 1.42446548806533e-05i,-5.89246972370578e-06 + 1.04027660517767e-05i,3.84828380364734e-06 - 7.62999952173191e-06i,-2.42372095448838e-06 + 5.61183401503663e-06i,1.43452715631277e-06 - 4.13294640733465e-06i,-7.52909982665315e-07 + 3.04335619441631e-06i,2.89150816537740e-07 - 2.23712029453423e-06i,2.03060633385000e-08 + 1.63852417730346e-06i,-2.20804609179772e-07 - 1.19295040758941e-06i,3.44691268137429e-07 + 8.60643323537310e-07i,-4.14912483575396e-07 - 6.12687765358100e-07i,4.55152170736340e-07 + 4.28224681788845e-07i,-4.61132648081134e-07 - 2.87575618023690e-07i,4.54292421313707e-07 + 1.83860804282433e-07i,-4.37538791983560e-07 - 1.06534710011033e-07i,4.14837823384914e-07 + 4.91523118092310e-08i,-3.88985033523531e-07 - 6.91253932017274e-09i,3.61851766417060e-07 - 2.37786624694223e-08i,-3.34618590873586e-07 + 4.56195805929297e-08i,3.07966489710476e-07 - 6.06385176245093e-08i,-2.82211707878050e-07 + 7.03610356661379e-08i,2.57409139425496e-07 - 7.59382385370836e-08i,-2.33434255005178e-07 + 7.82531870406503e-08i,2.10057128837743e-07 - 7.80212070003300e-08i,-1.87021547388951e-07 + 7.59053899320957e-08i,1.64138050198112e-07 - 7.26951243718856e-08i,-1.41387353202568e-07 + 6.97319716225760e-08i,1.19011658582219e-07 - 7.07601250398233e-08i,-9.77185614657112e-08 + 1.05008452403367e-07i,7.82876872054465e-08 + 3.29235172224771e-08i,-6.00830252833725e-08 + 4.66675738267202e-09i,4.51395086074534e-08 - 7.34746399323110e-09i,-3.31465133750335e-08 + 6.12682064658223e-09i,3.36005345725685e-11 - 4.47686779412194e-11i,-2.66336323655192e-11 + 3.56279560432930e-11i,2.11177981026579e-11 - 2.83624248219316e-11i,-1.67495832741754e-11 + 2.25857149822872e-11i,1.32892739781315e-11 - 1.79914728948294e-11i,-1.05473534637093e-11 + 1.43365284921426e-11i,8.37406446269062e-12 - 1.14280303969982e-11i,-6.65097664442893e-12 + 9.11277889086015e-12i,5.28442632534432e-12 - 7.26925225742747e-12i,-4.20036791806688e-12 + 5.80080406452355e-12i,3.34013068939432e-12 - 4.63084995697138e-12i,-2.65734266188811e-12 + 3.69835152086440e-12i,2.11529800836843e-12 - 2.95497122864558e-12i,-1.68490481983197e-12 + 2.36210942299031e-12i,1.34317730549061e-12 - 1.88925958211073e-12i,-1.07189951359388e-12 + 1.51199365527877e-12i,8.56606452437347e-13 - 1.21100785649420e-12i,-6.85918336018609e-13 + 9.70870953076464e-13i,5.50774703622636e-13 - 7.79381767457288e-13i,-4.44092679297015e-13 + 6.26745183529565e-13i,3.60253493703056e-13 - 5.05283315188621e-13i,-2.94798907507499e-13 + 4.08829220477358e-13i,2.44367026613901e-13 - 3.32553429238658e-13i,-2.06265560187546e-13 + 2.72615263696707e-13i,1.78565495723149e-13 - 2.26013652238066e-13i,-1.59747215455752e-13 + 1.90458759874446e-13i,1.48853152026618e-13 - 1.64174229766445e-13i,-1.45286560560010e-13 + 1.45897183223553e-13i,1.48797640875387e-13 - 1.34781075189494e-13i,-1.59566804214251e-13 + 1.30034871759221e-13i,1.78163039876722e-13 - 1.31811228598622e-13i,-2.05391259555654e-13 + 1.40040756768656e-13i,2.42639242031828e-13 - 1.55195301054789e-13i,-2.91752733083683e-13 + 1.78176917664530e-13i,3.55188101153203e-13 - 2.10095829622503e-13i,-4.36095604072762e-13 + 2.52707577086397e-13i,5.38569189245663e-13 - 3.08239544999367e-13i,-6.67764454842512e-13 + 3.79626885482764e-13i,8.30259472284212e-13 - 4.70616601244700e-13i,-1.03421785024871e-12 + 5.86024284654485e-13i,1.29014160465957e-12 - 7.32011673498789e-13i,-1.61104463103356e-12 + 9.16319103927421e-13i,2.01338945515772e-12 - 1.14876511081441e-12i,-2.51791122674039e-12 + 1.44178419203556e-12i,3.15058694194334e-12 - 1.81109131597995e-12i,-3.94422428745544e-12 + 2.27653074343082e-12i,4.93995643002787e-12 - 2.86322007769790e-12i,-6.18969112076151e-12 + 3.60284198308580e-12i,7.75861319635141e-12 - 4.53552386620038e-12i,-9.72894161066495e-12 + 5.71195001020097e-12i,1.22040641481469e-11 - 7.19625227463272e-12i,-1.53142880321422e-11 + 9.06949168544280e-12i,1.92238031049286e-11 - 1.14343118307048e-11i,-2.41394335076528e-11 + 1.44204960472738e-11i,3.03219879760341e-11 - 1.81924891817786e-11i,-3.81001202809372e-11 + 2.29582741706480e-11i,4.78885125998474e-11 - 2.89813867349054e-11i,-3.72622583460719e-09 - 1.39051123265020e-10i,5.33360851747405e-09 + 2.45049176893656e-10i,-7.30202317234866e-09 - 1.04825800952234e-09i,8.79519975044458e-09 + 7.38007161967070e-09i,-1.52956582134019e-08 + 1.35559060023843e-08i,1.77952093918485e-08 - 7.54873448281545e-09i,-2.13710641247754e-08 + 6.64898327728039e-09i,2.52631243159856e-08 - 6.29311077525724e-09i,-2.93851489894873e-08 + 5.89594679255929e-09i,3.37940271869357e-08 - 5.25475908814430e-09i,-3.86551591643458e-08 + 4.28130278202907e-09i,4.42441751783858e-08 - 2.97240612704717e-09i,-5.09639003909217e-08 + 1.44456989083580e-09i,5.93735735507122e-08 - 1.79053699058037e-11i,-7.02218018434236e-08 - 6.40624435132899e-10i,8.44610095703240e-08 - 6.97105389808370e-10i,-1.03194426434353e-07 + 6.10341561724210e-09i,1.27449374970206e-07 - 1.88116829013754e-08i,-1.57498722593629e-07 + 4.35029947782602e-08i,1.90601043721787e-07 - 8.66048814663385e-08i,-2.08470331130767e-07 + 1.57377364496781e-07i,-1.34529248303057e-07 - 1.22581149615663e-07i,-5.74515805140725e-07 + 2.60386513523642e-07i,6.07709107177040e-07 - 4.56914385853892e-07i,-6.92549763386985e-07 + 6.54251853591409e-07i,7.95404769023034e-07 - 8.80895098603013e-07i,-9.09231255879389e-07 + 1.14275380901845e-06i,1.03142788792916e-06 - 1.44468458338118e-06i,-1.16068911742311e-06 + 1.79308178558383e-06i,1.29601288894928e-06 - 2.19657709629968e-06i,-1.43612120767604e-06 + 2.66636735945571e-06i,1.57896080497115e-06 - 3.21652160023667e-06i,-1.72117195217828e-06 + 3.86438568735438e-06i,1.85744918918702e-06 - 4.63112581115915e-06i,-1.97971267109876e-06 + 5.54242419629992e-06i,2.07598747955741e-06 - 6.62933620876223e-06i,-2.12885310503033e-06 + 7.92933018957135e-06i,2.11327386200689e-06 - 9.48757039223912e-06i,-1.99354379537821e-06 + 1.13585882459775e-05i,1.71892152432853e-06 - 1.36087063447888e-05i,-1.21698622363157e-06 + 1.63203969770522e-05i,3.80514876274829e-07 - 1.96057899969115e-05i,1.00288714086848e-06 + 2.37889151637892e-05i,-2.55513240448432e-06 - 2.78880300310460e-05i,5.51504782626963e-06 + 3.36682201441105e-05i,-9.70488397385899e-06 - 4.04807860746257e-05i,1.57938512011042e-05 + 4.85906489809765e-05i,-2.46697617461223e-05 - 5.81886445760183e-05i,3.76570650789951e-05 + 6.94217717399111e-05i,-5.67672894918423e-05 - 8.23470206192761e-05i,8.51001292558068e-05 + 9.68392139530407e-05i,-0.000127519071726102 - 0.000112421637829321i,0.000191840607849368 + 0.000127950284534469i,-0.000291042765741514 - 0.000141002496965309i,0.000447658654206858 + 0.000146621451999662i,-0.000703341867044828 - 0.000134506771750893i,0.00114239586087620 + 8.18937325297179e-05i,-0.00196064428817326 + 6.81934157051595e-05i,0.00372970338526190 - 0.000496562197289015i,-0.00908012218431001 + 0.00216946054029757i,0.0801779799477410 - 0.0879155884091119i,0.0181642858886007 - 0.00416941929023356i,-0.0108088870851257 + 0.00340406213531626i,0.00883613806576105 - 0.00324839798687730i,-0.00814760313430364 + 0.00332417957200736i,0.00799435847315288 - 0.00352218653468467i,-0.00814156092878353 + 0.00380522339647046i,0.00849738115638908 - 0.00416015525418196i,-0.00902394440021254 + 0.00458423700444187i,0.00970854431152776 - 0.00508036080886044i,-0.0105525786223913 + 0.00565521857023659i,0.0115668986463334 - 0.00631860689280400i,-0.0127698774395685 + 0.00708325901317292i,0.0141868062984057 - 0.00796496520176805i,-0.0158500461546397 + 0.00898288402462062i,0.0177996880832364 - 0.0101600056463971i,-0.0200846231361523 + 0.0115237550529237i,0.0227639933670568 - 0.0131067355373403i,-0.0259090291390570 + 0.0149476194795442i,0.0296053270094583 - 0.0170921787158445i,-0.0339555416364893 + 0.0195944840589611i,0.0390826101016386 - 0.0225182015921248i,-0.0451334595623828 + 0.0259379673965899i,0.0522830428262717 - 0.0299407491650028i,-0.0607387336110353 + 0.0346268959369984i,0.0707443310452863 - 0.0401106154224422i,-0.0825829770421429 + 0.0465191763400559i,0.0965772471865711 - 0.0539898592132003i,-0.113083548540355 + 0.0626630915866508i,0.132476050347924 - 0.0726694933171789i,-0.155112704905876 + 0.0841077827239233i,0.181272717033339 - 0.0970100311670997i,-0.211052366796240 + 0.111291471005192i,0.244207857322142 - 0.126685552125317i,-0.279946834540181 + 0.142673298930086i,0.316704180029970 - 0.158430215681057i,-0.351997112180772 + 0.172829971801482i,0.382518338462141 - 0.184548554864687i,-0.404629233608290 + 0.192287472870052i];
   Psi =   fft(SiN.Stat.Sol.Psi_k);
ч5   SiN.Stat.Sol.Psi_k            = ifft(-0*real(Psi) + 1i*imag(Psi));
   SiN.Stat.Sol.V               =   0.0423;
    
   SiN_Soliton_Branch_Up.Stat    = Run_Branch_Universal(SiN.Stat);
        
%%    -4.8268
    ind1 = 2;
    [p_wh_1,p_wh_2,p_wh_3]    = Plot_LLE_Static_Branch_Soliton(SiN.CW,SiN_Soliton_Branch_Up.Stat,SiN_Soliton_Branch_Up.Stat,0,1,SiN_Soliton_Branch_Up(1).Stat(ind1));    
    figure('Name','Fields_Spectrums');    
    CF = conFigure([p_wh_1,p_wh_2,p_wh_3],1,3, 'UniformPlots', true, 'Height', 15, 'Width',40,'Labels',false);
    
%%
    ind1 = 100;
    ind2  = 1;
%    [p_wh_1,p_wh_2,p_wh_3,p_wh_4]      = Plot_LLE_Static_Branch_Soliton(SiN.CW,SiN_Soliton(ind2).Stat,SiN_Soliton(ind2).Stat,0,1,0,SiN_Soliton(ind2).Stat(ind1));
    [p_1,p_2,p_3]                      = Plot_Static_Field_Spectrums_Soliton(SiN_Soliton_Branch_Up(ind2).Stat(ind1),0);
    [p_dot_3,p_dot_4,p_dot_5,p_dot_6]  = Plot_Static_Field_Stability_Soliton(SiN_Soliton_Branch_Up(ind2).Stat(ind1),0);
    
    figure('Name','Fields_Spectrums')   ;    
    CF = conFigure([p_1,p_2,p_3,p_dot_3,p_dot_4,p_dot_5,p_dot_6],2,6, 'UniformPlots', true, 'Height', 15, 'Width',40,'Labels',false);

%%    
    ind1 = 1;
    [p_wh_1,p_wh_2,p_wh_3]    = Plot_LLE_Static_Branch_Soliton(SiN.CW,SiN_Soliton_Branch.Stat,SiN_Soliton_Branch.Stat,0,1,0,SiN_Soliton_Branch(1).Stat(ind1));
    [p_dot_1,p_dot_2]         = Plot_Static_Field_Spectrums(SiN_Soliton_Branch(1).Stat(ind1),0);
    [p_dot_3,p_dot_4,p_dot_5] = Plot_Static_Field_Stability(SiN_Soliton_Branch(1).Stat(ind1),0,1);
    
    figure('Name','Fields_Spectrums');
    
    CF = conFigure([p_wh_1,p_wh_2,p_wh_3,p_dot_1,p_dot_2,p_dot_3,p_dot_4,p_dot_5],2,4, 'UniformPlots', true, 'Height', 15, 'Width',40,'Labels',false);

% 
%%
    Plot_Static_Field_Spectrums(SiN_Soliton_Branch.Stat(101),1);
%%
    Plot_Static_Field_Stability(SiN_Soliton_Branch.Stat(101),1);
